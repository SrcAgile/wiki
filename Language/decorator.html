<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <script type="text/x-mathjax-config">
       MathJax.Hub.Config({
         tex2jax: {inlineMath: [['$(',')$'], ['\\(','\\)']]}
       });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <title>装饰器模式DP - Meta's Wiki</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/wiki/">Home</a>&nbsp;&#187;&nbsp;<a href="/wiki/#Language">Language</a>&nbsp;&#187;&nbsp;装饰器模式DP
    <span class="updated">Page Updated&nbsp;
      2017-08-26 21:00:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">装饰器模式DP</div>

  <p><strong>文档状态：</strong><a style="color:red;background-color:gray">编辑中....</a></p>
<ul>
<li><strong>今日音乐</strong></li>
</ul>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=390258&auto=0&height=66"></iframe>

<hr />
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">介绍</a><ul>
<li><a href="#_2">问题起源</a></li>
<li><a href="#uml">UML</a></li>
<li><a href="#_3">普通装饰器</a><ul>
<li><a href="#python">Python</a></li>
<li><a href="#java">Java</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<blockquote>
<p>OOP中的装饰器模式;java曾经使用组合加继承实现过装饰器模式[这好像不值得写：）]</p>
</blockquote>
<h2 id="_1">介绍</h2>
<ol>
<li><strong>[简.明]</strong> 允许向一个现有的对象添加新的功能，同时又不改变其结构。这种类型的设计模式属于结构型模式，它是作为现有的类的一个包装。</li>
<li><strong>[界.限]</strong> 在保持类方法签名完整性的前提下，提供了额外的功能[OOP]</li>
<li><strong>[场.景]</strong> 扩展一个类的功能/动态增加功能，动态撤销。</li>
<li><strong>[萌.物]</strong>  孙悟空[本质不变,动态七十二变]</li>
<li><strong>[缺.点]</strong> 层层嵌套,过于复杂</li>
<li><strong>[优.点]</strong> 无父类耦合问题</li>
<li><strong>[解.决]</strong> 兄弟类们属性在同一维度相斥没必要都添加进子类使子类膨胀，也没必要各立山头</li>
<li><strong>[身.份]</strong> 继承的替身</li>
</ol>
<h3 id="_2">问题起源</h3>
<p><code>InputStream inputStream = new BufferedInputStream(new FileInputStream(filePath));</code><br />
QAQ？看不懂咩～那别往下看了<br />
<strong>来自网络的释义</strong></p>
<div class="hlcode"><pre><span class="err">装饰器模式</span> <span class="n">_</span><span class="err">主要用于为对象动态的添加功能</span><span class="n">_</span><span class="err">。比如说，最简单的</span> <span class="n">IO</span> <span class="err">使用可能是如下代码：</span>

<span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>

<span class="err">但是我们发现，这个代码</span> <span class="err">每次进行读取都会进行</span> <span class="err">一次</span> <span class="n">IO</span><span class="err">，</span><span class="n">IO</span><span class="err">是比较耗费时间的。</span> <span class="err">那么有没有什么方法降低</span> <span class="n">IO</span> <span class="err">次数呢，自然想到了缓冲。那么此时有两种做法：</span>

<span class="err">定义一个</span> <span class="err">专门用于缓冲的文件读写</span> <span class="n">stream</span><span class="err">。</span>
<span class="err">为</span> <span class="n">FileInputStream</span> <span class="err">类进行扩展，让它支持</span> <span class="err">缓冲。</span>
<span class="err">肯定是第二种好，为什么呢。因为如果你按照</span><span class="mi">1</span><span class="err">方案，</span>
<span class="err">假如我要定义一个支持</span><span class="n">X</span><span class="err">功能，此时要定义一个</span> <span class="err">专门用于这个功能的</span><span class="n">stream</span><span class="err">，这个没有问题；</span>
<span class="err">假如我又要定义一个支持</span><span class="n">Y</span><span class="err">功能，此时要定义一个专门用于这个功能的</span><span class="n">stream</span><span class="err">，这个也没有问题；</span>

<span class="err">但是，假如我要定义一个</span> <span class="err">同时支持</span> <span class="n">X</span><span class="err">，</span><span class="n">Y</span><span class="err">功能，由于不能扩展，所以你必须再定义一个类，同时支持</span><span class="n">X</span><span class="err">，</span><span class="n">Y</span><span class="err">功能。这个就有问题了，问题就是重复了。</span>

<span class="n">_</span><span class="err">但是，</span><span class="mi">2</span> <span class="err">方案就能解决这个问题，</span> <span class="mi">2</span><span class="err">方案中当你需要一个同时支持</span> <span class="n">X</span><span class="err">，</span><span class="n">Y</span> <span class="err">功能的类，那你动态扩展便是了，不用再新定义一个类，同时支持</span><span class="n">XY</span><span class="err">。</span><span class="n">_</span>

<span class="err">这个就是装饰器模式的好处。</span>
</pre></div>


<h3 id="uml">UML</h3>
<p><center style="position:relative; left:80px; "><br />
<img alt="" src="https://raw.githubusercontent.com/srcmit/source/wiki/photo/decorator.png" /><br />
</center></p>
<div class="hlcode"><pre><span class="n">why</span><span class="err">要搞这么复杂呢，就是为了以后可以更好的扩展。像很多技术我们都知道它的原理，但是你看它们的源码，异常的捕获，各种检测，健壮性，扩展性，别人都考虑得很全，而且已经</span> <span class="n">code</span> <span class="err">下来了。&#39;</span> <span class="n">Talk</span> <span class="n">is</span> <span class="n">cheap</span><span class="p">,</span> <span class="n">show</span> <span class="n">me</span> <span class="n">the</span> <span class="n">code</span><span class="err">&#39;</span>

<span class="err">回到这个图，再对应着下面这个代码说：</span>

<span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">new</span> <span class="n">BufferedInputStream</span><span class="p">(</span><span class="n">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">filePath</span><span class="p">));</span>

<span class="n">Component</span><span class="err">：相当于</span> <span class="n">InputStream</span><span class="err">，</span><span class="n">Java</span> <span class="n">IO</span> <span class="err">中很多的流都是继承于</span> <span class="n">InputStream</span><span class="err">。也就是一个基础组件。</span>
<span class="n">ConcreteComponent</span><span class="err">：相当于</span> <span class="n">FileInputStream</span><span class="err">，一个基础组件的实现。</span>
<span class="n">Decorator</span><span class="err">：所有具体装饰器类的抽象父类，在</span><span class="n">Java</span> <span class="n">IO</span> <span class="err">包中</span> <span class="err">对应的是</span> <span class="n">FilterInputStream</span><span class="err">。</span>
<span class="n">ConcreteDecorator</span><span class="err">：具体的装饰者。相当于</span><span class="n">BufferedInputStream</span><span class="err">。</span>
</pre></div>


<h3 id="_3">普通装饰器</h3>
<h4 id="python">Python</h4>
<div class="hlcode"><pre><span class="mf">1.</span><span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="mf">2.</span>    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
<span class="mf">3.</span>        <span class="c">#代码装饰</span>
<span class="mf">4.</span>        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">)</span>
<span class="mf">5.</span>    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>


<p><code>注意line4 和 line5的return区别，一个返回的是对象，一个返回的是引用，所以无论外边再包几个高级函数</code></p>
<h4 id="java">Java</h4>
<div class="hlcode"><pre><span class="err">#定义</span>
<span class="c1">// The Window interface class</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Window</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">();</span> <span class="c1">// Draws the Window</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">();</span> <span class="c1">// Returns a description of the Window</span>
<span class="o">}</span>
<span class="c1">// implementation of a simple Window without any scrollbars</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleWindow</span> <span class="kd">implements</span> <span class="n">Window</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Draw window</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;simple window&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// abstract decorator class - note that it implements Window</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">WindowDecorator</span> <span class="kd">implements</span> <span class="n">Window</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">Window</span> <span class="n">decoratedWindow</span><span class="o">;</span> <span class="c1">// the Window being decorated</span>

    <span class="kd">public</span> <span class="nf">WindowDecorator</span> <span class="o">(</span><span class="n">Window</span> <span class="n">decoratedWindow</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">decoratedWindow</span> <span class="o">=</span> <span class="n">decoratedWindow</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="c1">// The first concrete decorator which adds vertical scrollbar functionality</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VerticalScrollBar</span> <span class="kd">extends</span> <span class="n">WindowDecorator</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">VerticalScrollBar</span><span class="o">(</span><span class="n">Window</span> <span class="n">windowToBeDecorated</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">windowToBeDecorated</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">draw</span><span class="o">();</span>
        <span class="n">drawVerticalScrollBar</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawVerticalScrollBar</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Draw the vertical scrollbar</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getDescription</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;, including vertical scrollbars&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="c1">// The second concrete decorator which adds horizontal scrollbar functionality</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HorizontalScrollBar</span> <span class="kd">extends</span> <span class="n">WindowDecorator</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">HorizontalScrollBar</span> <span class="o">(</span><span class="n">Window</span> <span class="n">windowToBeDecorated</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">windowToBeDecorated</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">draw</span><span class="o">();</span>
        <span class="n">drawHorizontalScrollBar</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">drawHorizontalScrollBar</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Draw the horizontal scrollbar</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getDescription</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;, including horizontal scrollbars&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="hlcode"><pre><span class="err">#测试</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="c1">// for print descriptions of the window subclasses</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printInfo</span><span class="o">(</span><span class="n">Window</span> <span class="n">w</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;description:&quot;</span><span class="o">+</span><span class="n">w</span><span class="o">.</span><span class="na">getDescription</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// original SimpleWindow</span>
        <span class="n">SimpleWindow</span> <span class="n">sw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleWindow</span><span class="o">();</span>
        <span class="n">printInfo</span><span class="o">(</span><span class="n">sw</span><span class="o">);</span>
        <span class="c1">// HorizontalScrollBar  mixed Window</span>
        <span class="n">HorizontalScrollBar</span> <span class="n">hbw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HorizontalScrollBar</span><span class="o">(</span><span class="n">sw</span><span class="o">);</span>
        <span class="n">printInfo</span><span class="o">(</span><span class="n">hbw</span><span class="o">);</span>
        <span class="c1">// VerticalScrollBar mixed Window</span>
        <span class="n">VerticalScrollBar</span> <span class="n">vbw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VerticalScrollBar</span><span class="o">(</span><span class="n">hbw</span><span class="o">);</span>
        <span class="n">printInfo</span><span class="o">(</span><span class="n">vbw</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="hlcode"><pre><span class="err">#结果</span>
<span class="nl">description:</span><span class="n">simple</span> <span class="n">window</span>
<span class="nl">description:</span><span class="n">simple</span> <span class="n">window</span><span class="o">,</span> <span class="n">including</span> <span class="n">horizontal</span> <span class="n">scrollbars</span>
<span class="nl">description:</span><span class="n">simple</span> <span class="n">window</span><span class="o">,</span> <span class="n">including</span> <span class="n">horizontal</span> <span class="n">scrollbars</span><span class="o">,</span> <span class="n">including</span> <span class="n">vertical</span> <span class="n">scrollbars</span>
</pre></div>
  <div id="comments"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script type="text/javascript">
  const gitment = new Gitment({
    title: '装饰器模式DP',
    owner: 'srcagile',
    repo: 'wiki',
    oauth: {
      client_id: '8d3768fea78397a633b8',
      client_secret: 'a79297700926ce00af68c66bc8ad1b06e6389cc0',
    },
    // ...
    // For more available options, check out the documentation below
  })
  gitment.render('comments')
  // or
  // gitment.render(document.getElementById('comments'))
  // or
  // document.body.appendChild(gitment.render())
  </script>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2018 Guozhen Li.
          <a href='https://github.com/srcagile/wiki' style="color:red">Fork me on GitHub</a>
          <span id="cnzz_stat_icon_1256629854">
            <a href="http://www.cnzz.com/stat/website.php?web_id=1256629854" target="_blank" title="站长统计">
              <img border="0" hspace="0" vspace="0" src="http://icon.cnzz.com/img/pic.gif">
            </a>
          </span>
       </p>
        <p>Site Generated 2018-02-18 22:49:45</p>
      </span>
    </div>

    
    
  </body>

</html>